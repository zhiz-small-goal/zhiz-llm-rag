# Machine-readable SSOT for README <-> code alignment (tools/).
# Consumers (future): tools/check_tools_readme_sync.py (check/write) + CI/gate.

version: 1
last_updated: "2026-01-20"
timezone: "America/Los_Angeles"

# Notes: this repo already has other doc-related gates.
# This SSOT focuses on README<->code alignment for tools/, and is designed to be composed
# with existing gates rather than replacing them.
related_gates:
  existing:
    - id: "check_docs_conventions"
      entrypoint: "python tools/check_docs_conventions.py"
      scope: "docs/, tools/"
      purpose: "Markdown 工程约定检查（H1 + 空行等），并生成 docs_conventions_report.json（report-output-v2）。"
    - id: "check_md_refs_contract"
      entrypoint: "python tools/check_md_refs_contract.py"
      scope: "repo (*.py callsites)"
      purpose: "md_refs API 契约门禁（signature + keyword-only callsites），防止引用解析接口漂移。"
  integration_policy:
    approach: "new_gate_tool"
    rationale: "README↔源码对齐属于独立职责；建议新建 gate（本计划的 check/write 工具）并在 gate.py/check_all.py 中组合调用，避免扩大既有工具职责边界。"

scope:
  # NOTE: keep globs stable; downstream tools may rely on these defaults.
  readme_globs:
    - "tools/README.md"
    - "tools/*_README.md"
    - "tools/*README*.md"
  exclude_globs:
    - "tools/**/__pycache__/**"

frontmatter:
  required_keys:
    - title
    - version
    - last_updated
  recommended_keys:
    - timezone

alignment_meta:
  # Migration note:
  # - Existing README files may not contain these keys yet.
  # - New/modified tools SHOULD add at least tool_id + impl.module.
  recommended_keys:
    - tool_id
    - impl.module
    - impl.wrapper
    - entrypoints
    - contracts.output
    - generation.options
    - generation.output_contract

sources_of_truth:
  interface:
    precedence:
      - "code:cli_definition"      # argparse/click/typer definitions
      - "code:help_snapshot"       # runtime `--help` output (when needed)
      - "readme:auto_blocks"
      - "readme:free_text"
  output_contract:
    ssot_docs:
      - "docs/reference/REPORT_OUTPUT_ENGINEERING_RULES.md"
      - "docs/reference/report_tools_registry.toml"
      - "docs/reference/reference.yaml"  # exit_codes + gate paths
    precedence:
      - "ssot_docs"
      - "code:reporting"          # unified reporting helpers
      - "readme:auto_blocks"
      - "readme:free_text"

auto_blocks:
  # README generation zones. These blocks are treated as derived content.
  markers:
    options:
      begin: "<!-- AUTO:BEGIN options -->"
      end: "<!-- AUTO:END options -->"
      purpose: "CLI 参数表（flag/default/required/notes）"
    output_contract:
      begin: "<!-- AUTO:BEGIN output-contract -->"
      end: "<!-- AUTO:END output-contract -->"
      purpose: "输出契约摘要（schema_version/paths/channel rules）"
    artifacts:
      begin: "<!-- AUTO:BEGIN artifacts -->"
      end: "<!-- AUTO:END artifacts -->"
      purpose: "产物与副作用清单（落盘文件/目录/覆盖策略）"

normalization:
  path_separator: "/"
  sort_flags: "lexicographic"
  line_ending: "\n"

checks:
  # Default checks to enforce when running in --check mode.
  enforce:
    - frontmatter_present
    - frontmatter_required_keys
    - auto_block_markers_well_formed
    - options_match_when_present
    - output_contract_refs_when_v2

exceptions:
  # Where exceptions live (if used). Tools may choose to keep this empty.
  # The file itself is not required to exist until the first exception is added.
  path: "docs/reference/readme_code_sync_exceptions.yaml"