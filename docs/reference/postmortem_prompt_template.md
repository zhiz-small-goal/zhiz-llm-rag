---
title: Postmortem Prompt Template
version: 2.1
last_updated: 2026-01-06
language: zh-CN
purpose: "给 ChatGPT 的复盘提示词模板：可审计、可复现、可迁移"
---

# Postmortem / 复盘提示词模板（面向 ChatGPT）


> 目标：在我提供日志与上下文后，你输出一份**可审计、可复现、可回归**的 postmortem，并把经验萃取为**可迁移的项目建设资产**（门禁/清单/原则库）。  
> 写作原则：**只写必要内容**；无证据不下结论；不确定处用“默认假设/信息缺口”明确标注。

---

## 目录
- [0. 使用方式](#0-使用方式)
- [1. Mode（必选）](#1-mode必选)
- [2. 输入契约（我会提供）](#2-输入契约我会提供)
- [3. 输出硬约束（你必须满足）](#3-输出硬约束你必须满足)
- [4. 证据账本 Evidence Ledger（必填）](#4-证据账本-evidence-ledger必填)
- [5. 根因分析 RCA（必填）](#5-根因分析-rca必填)
- [6. 行动项 Action Items（必填）](#6-行动项-action-items必填)
- [7. 方法论迁移（必填）](#7-方法论迁移必填)
- [8. 输出自检 Quality Gates（必填）](#8-输出自检-quality-gates必填)
- [9. 最终输出模板（直接按此填充）](#9-最终输出模板直接按此填充)

---

## 0. 使用方式

把你接下来的输出当作“复盘文档”，必须满足以下约束：

- **输出顺序固定**：先目录（TOC）→ 再按**第 9 节给出的 0–12 小节**逐节填写（详见第 9 节模板）。
- **锚点必须可点击**：TOC 使用 Markdown 锚点写法：`[显示文本](#锚点标识)`。
- **定位格式统一**：涉及诊断定位时，优先使用 `file:line:col`（例如 `tools/check_x.py:120:5`）。  
  若来自命令输出，用 `CMD:` 前缀记录“命令 + 关键输出行”。

---

## 1. Mode（必选）

你必须在输出的 YAML 元信息中填写 `mode`，并按该模式控制粒度：

- `mode: solo_debug`  
  适用：个人项目排障/小范围返工。允许简化时间线与影响面，但仍必须输出：证据账本、RCA、行动项、回归/门禁、方法论迁移与自检。
- `mode: team_incident`  
  适用：多人协作/线上事故/影响面较大。必须输出完整时间线、影响评估、沟通/响应记录，以及行动项的 owner/due 追踪。  
  - **强制要求**：在第 9 节的 **5) 排查过程** 中填写 `5.1 Timeline` 与 `5.2 Response/Comms`（见模板）。

若我未指定 mode：默认 `solo_debug`（必须在“默认假设”中标注）。

---

## 2. 输入契约（我会提供）

我会尽量提供以下信息；你必须**按现有信息推进**，缺失项进入“信息缺口”而不是臆测：

- 发生日期（可选；缺省用“今日”，但请同时写出**绝对日期**）
- 项目/仓库路径（可选）
- 命令行日志（必须：命令 + 输出 + 报错堆栈）
- 预期结果 vs 实际结果（尽量提供）
- 我已尝试过的动作（可选）
- 相关文件片段或路径（可选）
- 环境信息（可选）：OS、Python/Node 版本、venv 名称、关键依赖版本

---

## 3. 输出硬约束（你必须满足）

### 3.1 事实与推断

- 用两类标签区分并且**保持克制**：
  - **Facts**：必须能被 Evidence Ledger 中的 E# 引用支撑。
  - **Inference（推断）**：必须引用至少一个 E#，并给出**可证伪方式**（如何验证/反证）。
- 任何结论若没有 E# 支撑：只能写入“默认假设”或“信息缺口”，不得当作事实。
- **硬规则**：你输出中的任何一句“推断/解释/归因”若无法引用至少一个 E#，必须移入“默认假设/信息缺口与补采计划”，不得留在正文段落中。

### 3.2 可复现与可回归

- 必须给出：
  - **复现步骤**（最小可复现 MRE：环境 + 命令 + 期望/实际）
  - **修复步骤**（止血/修复/回滚点）
  - **回归测试**（命令 + PASS 条件）
  - **门禁化建议**：至少 1 条可自动化的检查（脚本/CI/检查器/契约校验）

### 3.3 风格与篇幅

- 不扩写、不写背景故事；每节仅保留能推动定位、修复与迁移的内容。
- 避免泛泛口号。每条建议必须包含：**为何（因果）+ 如何做（命令/改动点）+ 如何验收（PASS 条件）**。

---

## 4. 证据账本 Evidence Ledger（必填）

你必须先建立 Evidence Ledger，然后在全文引用 E# 来支撑结论（类似论文引用）。

> 每条证据都必须满足：来源可定位、能证明什么、如何证伪。

**Ledger 模板：**

- **E1**
  - 来源：`CMD:` / `file:` / `log:` / `config:` / `commit:` …
  - 定位：`tools/x.py:120:5` 或 `CMD: python tools/x.py ...` + 关键输出行
  - 能证明什么：一句话
  - 反证方式：一句话（怎么证伪）

> 注意：Ledger 必须只收录“你在输入中实际看到”的内容；若需要新增证据采集命令，写在“信息缺口→补采计划”。

---

## 5. 根因分析 RCA（必填）

RCA 必须固定拆成四块（不允许合并；无则写 N/A + 原因）：

1) **Trigger（直接触发）**：导致问题暴露的最后一步（一次命令/一次提交/一次配置变更）。  
2) **Root Cause（根因）**：系统层面的因果机制（接口契约不一致、状态机缺失、环境漂移、入口点不一致、不可观测等）。  
3) **Contributing Factors（促成因素）**：使其更易发生/更难发现的条件（缺日志、缺回归、缺门禁、文档漂移、多 venv 不一致等）。  
4) **Missing Controls（缺失控制点/门禁）**：本应更早拦住它的检查点是什么（preflight、schema 校验、契约测试、golden case、CI 门禁）。  
   - 必须写清：控制点应落到哪里（文件/脚本/CI 步骤）、**触发时机**（preflight/CI/运行时探针/发布前等）、失败策略（FAIL / WARNING）、以及验收命令。

---

## 6. 行动项 Action Items（必填）

你必须输出一张行动项表，并满足以下规则：

- 每条行动项必须包含：`action_id`、类型、改动点、owner、due、验证方式（命令 + PASS 条件）、回滚策略。
- `due` 格式要求：优先使用 `YYYY-MM-DD`；若使用 `T+N`，必须同时给出对应的绝对日期（YYYY-MM-DD）。
- 行动项类型枚举建议：`mitigate`（止血）/ `prevent`（防复发）/ `detect`（更早发现）/ `doc`（文档与契约同步）/ `cleanup`（技术债）。

**表格模板：**

| action_id | 类型 | 改动点（文件/脚本/配置） | owner | due | 验证方式（命令 + PASS） | 回滚策略 |
|---|---|---|---|---|---|---|
| A1 | prevent |  |  |  |  |  |

---

## 7. 方法论迁移（必填）

本节不是鸡汤；必须输出**可迁移、可执行**的资产，固定四段：

### 7.1 事件级公式（This time）
用一句话公式化本次踩坑：

> 在{约束}下，因为{缺失控制点}，导致{错误穿透路径}，最终暴露为{现象}。

### 7.2 模式级归类（Recurring pattern）
从以下“失败模式词表”中选择 1–3 个最匹配的，并解释为什么（每个不超过 3 行）：

- 契约漂移（schema/接口/参数口径不一致）
- 环境漂移（多设备/多 venv/依赖版本不一致）
- 入口不一致（CLI/脚本/CI 走不同路径）
- 不可观测（缺关键日志/缺指标/缺探针）
- 无回滚/不可逆改动（修复难以撤销或验证）
- 状态不一致（缓存/产物/索引与源数据错位）
- 文档漂移（文档与代码/契约不一致）

### 7.3 原则级规则（Principles）
输出 **3 条原则**，每条必须包含：适用条件、操作化规则、反例（如何踩坑）。

- P1：……
- P2：……
- P3：……

### 7.4 跨域类比（Engineering → Life）
输出 **3 条类比**，每条必须落到一个可执行动作（例如清单/门禁/验收口径/回滚点），不超过 4 行：

- L1：……
- L2：……
- L3：……

> 强制约束：原则与类比必须至少各有 1 条能落盘为“清单项/门禁项/脚本/文档章节”的候选（写明落盘位置）。

---

## 8. 输出自检 Quality Gates（必填）

在文末输出自检清单，逐条回答 `Yes/No`；若 `No`，必须给补救动作（补采证据/改写结论/新增验证命令等）。

- Q1：所有 **Inference（推断）** 是否都引用了至少一个 E#？  
- Q2：所有建议是否都包含 **为何 + 如何做 + 如何验收**？  
- Q3：是否至少产出 **1 条自动化门禁**（脚本/CI/检查器）并给出命令与 PASS 条件？  
- Q4：行动项表是否每条都包含 `owner/due/verify/rollback`，且 `due` 格式符合要求？  
- Q5：方法论迁移是否包含 **事件公式 + 模式枚举 + 3 原则（带反例）+ 3 类比动作**？  
- Q6：是否列出了“信息缺口清单”以及“补采计划（命令/文件）”？

---

## 9. 最终输出模板（直接按此填充）

> 你必须严格按以下结构输出；除非 mode = team_incident，否则时间线与沟通/响应可写 N/A，但不可删除字段。

### 目录（TOC）
（用 Markdown 锚点写法，覆盖 0–12 小节）

---

### 0) 元信息（YAML）
```yaml
date: "YYYY-MM-DD"
mode: "solo_debug|team_incident"
repo_path: "可选"
env:
  os: "可选"
  python: "可选"
  venv: "可选"
  key_deps:        # 可选；建议列表，便于统计
    - "pkgA==x.y.z"
    - "pkgB==x.y.z"
scope:
  component: "受影响组件/脚本/模块"
  severity: "可选：P0|P1|P2|P3"
```

---

### 1) 总结（Summary）
- 现象（1–2 条，引用 E#）
- 影响（可选；team_incident 必填）
- 结论一句话：总体路径 + 可行性（可行/受限/不适用）【引用 E# 或标默认假设】

---

### 2) 预期 vs 实际（Expected vs Actual）
- 预期：
- 实际：
- 差异点（引用 E#）

---

### 3) 证据账本（Evidence Ledger）
- E1 …
- E2 …
- E3 …

---

### 4) 复现（MRE：最小可复现）
- 环境：
- 步骤（命令）：
- 期望输出：
- 实际输出（引用 E#）

---

### 5) 排查过程（Investigation）
按时间/依赖顺序写（每步包含：做什么 + 为什么 + 看到什么证据 E#）：

#### 5.1 Timeline（team_incident 必填；solo_debug 可 N/A）
- T1（时间戳）：发生了什么（动作/系统响应）【E# 或标缺口】
- T2（时间戳）：…
- T3（时间戳）：…

#### 5.2 Response/Comms（team_incident 必填；solo_debug 可 N/A）
- 谁在什么时候做了什么响应（例如回滚/降级/通知/协同），以及依据证据是什么【E#】
- 若存在决策分歧：记录最终取舍与原因（引用 E# 或标默认假设）

#### 5.3 Investigation Steps（必填）
- Step 1 …
- Step 2 …
- Step 3 …

---

### 6) 根因分析（RCA）
1) Trigger：…
2) Root Cause：…
3) Contributing Factors：…
4) Missing Controls：…（落点 + 触发时机 + FAIL/WARN + 验收命令）

---

### 7) 修复与处置（Mitigation & Fix）
- 止血（可选）：…
- 最终修复：…
- 代码/配置改动点：`file:line` 或 commit（若有）
- 回滚点：…

---

### 8) 回归测试与门禁（Regression & Gates）
- 回归测试命令：
- PASS 条件：
- 新增/建议门禁（至少 1 条）：脚本/CI/检查器 + 触发时机 + FAIL/WARN

---

### 9) 行动项（Action Items）
（输出行动项表）

---

### 10) 方法论迁移（可迁移资产）
- 事件级公式（7.1）
- 模式级归类（7.2）
- 原则级规则（7.3）
- 跨域类比动作（7.4）
- （可选）建议落盘位置：如 [LESSONS（经验库）](../explanation/LESSONS.md)、[PREFLIGHT_CHECKLIST（门禁清单）](../howto/PREFLIGHT_CHECKLIST.md)

---

### 11) 信息缺口与补采计划（Gaps & Next Evidence）
- 缺口清单：
- 补采命令/文件（CMD / file）：
- 预期看到什么（将变成哪条 E#）：

---

### 12) 输出自检（Quality Gates）
- Q1：Yes/No（若 No：…）
- Q2：Yes/No（若 No：…）
- Q3：Yes/No（若 No：…）
- Q4：Yes/No（若 No：…）
- Q5：Yes/No（若 No：…）
- Q6：Yes/No（若 No：…）
